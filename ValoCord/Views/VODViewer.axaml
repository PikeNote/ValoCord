<wnd:AppWindow xmlns="https://github.com/avaloniaui"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
               xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
               xmlns:wnd="clr-namespace:FluentAvalonia.UI.Windowing;assembly=FluentAvalonia"
               xmlns:controls="clr-namespace:FluentAvalonia.UI.Controls;assembly=FluentAvalonia"
               xmlns:avalonia="clr-namespace:LibVLCSharp.Avalonia;assembly=LibVLCSharp.Avalonia"
               x:DataType="viewModels:VODViewerViewModel"
               xmlns:viewModels="clr-namespace:ValoCord.ViewModels"
               xmlns:userControls="clr-namespace:ValoCord.UserControls"
               mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
               x:Class="ValoCord.Views.VODViewer"
               Title="{Binding WindowTitle}" AttachedToVisualTree="Visual_OnAttachedToVisualTree" Closing="Window_OnClosing">
    <Design.DataContext>
        <viewModels:VODViewerViewModel />
    </Design.DataContext>

    <Grid RowSpacing="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
          RowDefinitions="Auto Auto * Auto">
        <StackPanel Grid.Row="0">
            <Grid  Name="TitleBarHost"
                   ColumnDefinitions="Auto,Auto,*,Auto" 
                   Background="Transparent">
                <Image Margin="12 4"
                       IsHitTestVisible="False"
                       Source="/Assets/Logo.png"
                       Width="18" Height="18"
                       DockPanel.Dock="Left"
                       Name="WindowIcon"
                       RenderOptions.BitmapInterpolationMode="HighQuality">
                    <Image.IsVisible>
                        <OnPlatform Default="False">
                            <On Options="Windows" Content="True" />
                        </OnPlatform>
                    </Image.IsVisible>
                </Image>

                <TextBlock Text="{Binding Title, RelativeSource={RelativeSource FindAncestor, AncestorType=Window}}"
                           FontSize="12"
                           IsHitTestVisible="False"
                           VerticalAlignment="Center"
                           Grid.Column="1"
                           FontFamily="VALORANT">
                    <TextBlock.IsVisible>
                        <OnPlatform Default="False">
                            <On Options="Windows" Content="True" />
                        </OnPlatform>
                    </TextBlock.IsVisible>
                </TextBlock>
            </Grid>
        </StackPanel>
    
        <StackPanel Margin="10" Grid.Row="1">
            <StackPanel Orientation="Horizontal" Spacing="10">
                <TextBlock FontSize="20" VerticalAlignment="Center" >Match Details</TextBlock>
                <TextBlock VerticalAlignment="Center" Text="{Binding GameTime}"/>
            </StackPanel>
            <TextBlock FontSize="15" Text="{Binding GameDescription}"/>
        </StackPanel>
    
        <Grid HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
              ColumnDefinitions="3*, *" Margin="10" Grid.Row="2">
            

            <Grid Grid.Column="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                
                <avalonia:VideoView  x:Name="VODVideoView"  Grid.Row="0" HorizontalAlignment="Stretch"
                                     VerticalAlignment="Stretch" /> 
                <StackPanel Grid.Row="1"
                            Orientation="Vertical"
                            VerticalAlignment="Bottom"
                            HorizontalAlignment="Stretch"
                            Margin="0,10,0,0" >
                    
                    <Slider Maximum="1"
                            Minimum="0"
                            IsEnabled="{Binding IsPlaying, ElementName=VideoViewControl}"
                            Value="{Binding Progress}"
                            SmallChange="0.005"
                            LargeChange="0.05"
                            ValueChanged="RangeBase_OnValueChanged"
                            x:Name="VideoProgress"
                    />
                    <Grid ColumnDefinitions="Auto,*,Auto" Margin="5,0">
                        <TextBlock Grid.Column="0"
                                   Text="{Binding CurrentTime}"
                                   Foreground="White"
                                   FontSize="12" />

                        <TextBlock Grid.Column="2"
                                   Text="{Binding TotalDuration}"
                                   Foreground="White"
                                   FontSize="12"
                                   HorizontalAlignment="Right" />
                    </Grid>
                    <StackPanel Orientation="Horizontal" Grid.Row="0"
                                VerticalAlignment="Bottom"
                                HorizontalAlignment="Center"
                                Spacing="20">
                        <controls:SymbolIcon Symbol="Back" FontSize="30" Foreground="White"/>
                        <Button Command="{Binding TogglePlayPause}" Classes.IsPlaying="{Binding IsPlaying, Mode=OneWay}" Classes.IsNotPlaying="{Binding !IsPlaying, Mode=OneWay}">
                            <Button.Styles>
                                <Style Selector="Button.IsPlaying">
                                    <Setter Property="Content">
                                        <Template>
                                            <controls:SymbolIcon Symbol="Pause" FontSize="30" Foreground="White"/>
                                        </Template>
                                    </Setter>
                                </Style>
                                <Style Selector="Button.IsNotPlaying">
                                    <Setter Property="Content">
                                        <Template>
                                            <controls:SymbolIcon Symbol="Play" FontSize="30" Foreground="White"/>
                                        </Template>
                                    </Setter>
                                </Style>
                            </Button.Styles>
                           
                        </Button>
                        <controls:SymbolIcon Symbol="Forward" FontSize="30" Foreground="White" />
                    </StackPanel>
                                            
                </StackPanel>
                
            </Grid>
            
            <StackPanel Background="#171717" Grid.Column="1" 
                        VerticalAlignment="Stretch" 
                        HorizontalAlignment="Stretch" Margin="10 0 10 0">
                <userControls:KillEvent/>
                <userControls:KillEvent/>
                <userControls:KillEvent/>
                <userControls:KillEvent/>
                <userControls:KillEvent/>
            </StackPanel>
        
        </Grid>
        <ListBox ItemsSource="{Binding RoundDataList}" HorizontalAlignment="Stretch" Grid.Row="3" >
            <ListBox.Styles>
                <Style Selector="ListBoxItem">
                    <Setter Property="Margin" Value="0" />
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"></Setter>
                </Style>
            </ListBox.Styles>
            <ListBox.ItemContainerTheme>
                <ControlTheme TargetType="ListBoxItem">
                    <Setter Property="Margin" Value="0"/>
                </ControlTheme>
            </ListBox.ItemContainerTheme>
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <UniformGrid Columns="{Binding RoundDataList.Count}" 
                                 HorizontalAlignment="Stretch" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Button BorderThickness="2.5" 
                            Background="#fe4554" 
                            BorderBrush="#171717" HorizontalAlignment="Stretch" 
                            VerticalAlignment="Stretch" CornerRadius="0">
                        <Interaction.Behaviors>
                            <DataTriggerBehavior Binding="{Binding TeamWon}" ComparisonCondition="Equal" Value="{Binding $parent[ItemsControl].((viewModels:VODViewerViewModel)DataContext).TeamWon}">
                                <ChangePropertyAction PropertyName="Background" Value="#008000" />
                            </DataTriggerBehavior>
                            <DataTriggerBehavior Binding="{Binding TeamWon}" ComparisonCondition="NotEqual" Value="{Binding $parent[ItemsControl].((viewModels:VODViewerViewModel)DataContext).TeamWon}">
                                <ChangePropertyAction PropertyName="Background" Value="#fe4554" />
                            </DataTriggerBehavior>
                        </Interaction.Behaviors>
                        <TextBlock Text="{Binding RoundNumber}" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" TextAlignment="Center"/>
                    </Button>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>
    </Grid>
</wnd:AppWindow>